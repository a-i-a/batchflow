

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>TFModel &#8212; BatchFlow 0.3.0 documentation</title>
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="VGG" href="batchflow.models.tf.vgg.html" />
    <link rel="prev" title="Models" href="batchflow.models.tf.models.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="batchflow.models.tf.vgg.html" title="VGG"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="batchflow.models.tf.models.html" title="Models"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">BatchFlow 0.3.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../intro/classes.html" >Classes and capabilities</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../intro/tf_models.html" >Tensorflow models</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="batchflow.models.tf.models.html" accesskey="U">Models</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="batchflow.models.tf.models.html"
                        title="previous chapter">Models</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="batchflow.models.tf.vgg.html"
                        title="next chapter">VGG</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/api/batchflow.models.tf.base.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-batchflow.models.tf.base">
<span id="tfmodel"></span><h1>TFModel<a class="headerlink" href="#module-batchflow.models.tf.base" title="Permalink to this headline">¶</a></h1>
<p>Contains base class for tensorflow models</p>
<dl class="data">
<dt id="batchflow.models.tf.base.LOSSES">
<code class="sig-name descname">LOSSES</code><em class="property"> = {'absolutedifference': &lt;function absolute_difference&gt;, 'bce': &lt;function sigmoid_cross_entropy&gt;, 'ce': &lt;function softmax_cross_entropy&gt;, 'cos': &lt;function cosine_distance&gt;, 'cosine': &lt;function cosine_distance&gt;, 'crossentropy': &lt;function softmax_cross_entropy&gt;, 'dice': &lt;function dice&gt;, 'hinge': &lt;function hinge_loss&gt;, 'huber': &lt;function huber_loss&gt;, 'l1': &lt;function absolute_difference&gt;, 'logloss': &lt;function log_loss&gt;, 'mse': &lt;function mean_squared_error&gt;}</em><a class="headerlink" href="#batchflow.models.tf.base.LOSSES" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="batchflow.models.tf.base.DECAYS">
<code class="sig-name descname">DECAYS</code><em class="property"> = {'const': &lt;function piecewise_constant&gt;, 'exp': &lt;function exponential_decay&gt;, 'invtime': &lt;function inverse_time_decay&gt;, 'naturalexp': &lt;function natural_exp_decay&gt;, 'poly': &lt;function polynomial_decay&gt;}</em><a class="headerlink" href="#batchflow.models.tf.base.DECAYS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="batchflow.models.tf.base.TFModel">
<em class="property">class </em><code class="sig-name descname">TFModel</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">batchflow.models.base.BaseModel</span></code></p>
<p>Base class for all tensorflow models</p>
<p><strong>Configuration</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">build</span></code> and <code class="docutils literal notranslate"><span class="pre">load</span></code> are inherited from <a class="reference internal" href="batchflow.models.html#batchflow.models.BaseModel" title="batchflow.models.BaseModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseModel</span></code></a>.</p>
<dl>
<dt>device<span class="classifier">str or callable</span></dt><dd><p>if str, a device name (e.g. ‘/device:GPU:0’).
if callable, a function which takes an operation and returns a device name for it.
See <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/device">tf.device</a> for details.</p>
</dd>
<dt>session<span class="classifier">dict</span></dt><dd><p><a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/Session#__init__">Tensorflow session parameters</a>.</p>
</dd>
<dt>inputs<span class="classifier">dict</span></dt><dd><p>model inputs (see <a class="reference internal" href="#batchflow.models.tf.TFModel._make_inputs" title="batchflow.models.tf.TFModel._make_inputs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TFModel._make_inputs()</span></code></a>)</p>
</dd>
<dt>loss - a loss function, might be defined in one of three formats:</dt><dd><ul class="simple">
<li><p>name</p></li>
<li><p>tuple (name, args)</p></li>
<li><p>dict {‘name’: name, **args}</p></li>
</ul>
<dl class="simple">
<dt>where name might be one of:</dt><dd><ul class="simple">
<li><p>short name (<cite>‘mse’</cite>, <cite>‘ce’</cite>, <cite>‘l1’</cite>, <cite>‘cos’</cite>, <cite>‘hinge’</cite>, <cite>‘huber’</cite>, <cite>‘logloss’</cite>, <cite>‘dice’</cite>)</p></li>
<li><p>a function name from <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/losses">tf.losses</a>
(e.g. <cite>‘absolute_difference’</cite> or <cite>‘sparse_softmax_cross_entropy’</cite>)</p></li>
<li><p>callable</p></li>
</ul>
</dd>
</dl>
<p>It is possible to compute loss not only with network output and ground truth, but with
any named Tensors in model by passing <cite>‘predictions’</cite> and <cite>‘targets’</cite> keywords.</p>
<p>If loss is a callable, then it should add the result to a loss collection.
Otherwise, <code class="docutils literal notranslate"><span class="pre">add_loss</span></code> should be set to True. An optional collection might also be specified through
<code class="docutils literal notranslate"><span class="pre">loss_collection</span></code> parameter.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Losses from non-default collections won’t be detected automatically,
so you should process them within your code.</p>
</div>
<p>Examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{'loss':</span> <span class="pre">'mse'}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'loss':</span> <span class="pre">{'name':</span> <span class="pre">'sigmoid_cross_entropy',</span> <span class="pre">'label_smoothing':</span> <span class="pre">1e-6}}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'loss':</span> <span class="pre">(tf.losses.huber_loss,</span> <span class="pre">{'reduction':</span> <span class="pre">tf.losses.Reduction.MEAN})}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'loss':</span> <span class="pre">{'name':</span> <span class="pre">'dice',</span> <span class="pre">'predictions':</span> <span class="pre">'body_output',</span> <span class="pre">'targets':</span> <span class="pre">'body_targets'}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'loss':</span> <span class="pre">external_loss_fn_with_add_loss_inside}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'loss':</span> <span class="pre">external_loss_fn_without_add_loss,</span> <span class="pre">'add_loss':</span> <span class="pre">True}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'loss':</span> <span class="pre">external_loss_fn_to_collection,</span> <span class="pre">'add_loss':</span> <span class="pre">True,</span> <span class="pre">'loss_collection':</span> <span class="pre">tf.GraphKeys.LOSSES}</span></code></p></li>
</ul>
</dd>
<dt>decay - a learning rate decay algorithm might be defined in one of three formats:</dt><dd><ul class="simple">
<li><p>name</p></li>
<li><p>tuple (name, args)</p></li>
<li><p>dict {‘name’: name, <a href="#id1"><span class="problematic" id="id2">**</span></a>args}</p></li>
</ul>
<p>where name might be one of:</p>
<ul class="simple">
<li><p>short name (‘exp’, ‘invtime’, ‘naturalexp’, ‘const’, ‘poly’)</p></li>
<li><p>a function name from <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/train">tf.train</a>
(e.g. ‘exponential_decay’)</p></li>
<li><p>a callable</p></li>
</ul>
<p>Examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{'decay':</span> <span class="pre">'exp'}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'decay':</span> <span class="pre">('polynomial_decay',</span> <span class="pre">{'decay_steps':</span> <span class="pre">10000})}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'decay':</span> <span class="pre">{'name':</span> <span class="pre">tf.train.inverse_time_decay,</span> <span class="pre">'decay_rate':</span> <span class="pre">.5}</span></code></p></li>
</ul>
</dd>
<dt>scope - subset of variables to optimize during training. Can be either string or sequence of strings.</dt><dd><p>Value <cite>‘’</cite> is reserved for optimizing all trainable variables.
Putting <cite>-</cite> sign before name stands for complement: optimize everything but
the passed scope.</p>
<p>Examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{'scope':</span> <span class="pre">''}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'scope':</span> <span class="pre">'body/custom_layer'}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'scope':</span> <span class="pre">'-body/custom_layer'}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'scope':</span> <span class="pre">['body/custom_layer_1',</span> <span class="pre">'head/custom_layer_2']}</span></code></p></li>
</ul>
</dd>
<dt>optimizer - an optimizer might be defined in one of three formats:</dt><dd><blockquote>
<div><ul class="simple">
<li><p>name</p></li>
<li><p>tuple (name, args)</p></li>
<li><p>dict {‘name’: name, **args}</p></li>
</ul>
<p>where name might be one of:</p>
<ul class="simple">
<li><p>short name (e.g. ‘Adam’, ‘Adagrad’, any optimizer from
<a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/train">tf.train</a> without a word <cite>Optimizer</cite>)</p></li>
<li><p>a function name from <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/train">tf.train</a>
(e.g. ‘FtlrOptimizer’)</p></li>
<li><p>a callable</p></li>
</ul>
</div></blockquote>
<p>Examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{'optimizer':</span> <span class="pre">'Adam'}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'optimizer':</span> <span class="pre">('Ftlr',</span> <span class="pre">{'learning_rate_power':</span> <span class="pre">0})}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'optimizer':</span> <span class="pre">{'name':</span> <span class="pre">'Adagrad',</span> <span class="pre">'initial_accumulator_value':</span> <span class="pre">0.01}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'optimizer':</span> <span class="pre">functools.partial(tf.train.MomentumOptimizer,</span> <span class="pre">momentum=0.95)}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'optimizer':</span> <span class="pre">some_optimizer_fn}</span></code></p></li>
</ul>
</dd>
<dt>train_steps - configuration of different training procedures.</dt><dd><p>Must be a mapping from string names to dictionary with train parameters like
loss, decay, scope, optimizer. Those keys support syntax defined above.
If any of loss, decay, scope, optimizer is defined in config, it serves as default
value for every train step.
Optimizer and decay, created at one train step, can be used in another. To do so, one can
pass ‘use’ key with value corresponding to the name of train step from which you want to borrow optimizer.
Note that in this case you are still free to change loss-function or scope.</p>
<p>In order to use particular train step during train, one must pass <cite>train_mode</cite> argument
to <cite>train</cite> method.</p>
<p>Examples:</p>
<ul class="simple">
<li><dl class="simple">
<dt><a href="#id5"><span class="problematic" id="id6">``</span></a>{‘train_steps’: {‘all’: {‘loss’: ‘ce’, ‘optimizer’: ‘Adam’, ‘scope’: ‘’},</dt><dd><p>‘body’: {‘loss’: ‘dice’, ‘optimizer’: ‘RMSProp’, ‘scope’: ‘body’}}
‘custom’: {‘use’: ‘body’, ‘loss’: ‘ce’, ‘scope’: ‘head’}}``</p>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>microbatch<span class="classifier">int</span></dt><dd><p>size of chunks to split every batch in. Allows to process given data sequentially, accumulating gradients
from microbatches and applying them once in the end. Can be changed later in the <cite>train</cite> method.
Note that the microbatch size must be a divisor of the batch size.</p>
</dd>
<dt>common<span class="classifier">dict</span></dt><dd><p>default parameters for all <a class="reference internal" href="batchflow.models.tf.layers.html#batchflow.models.tf.layers.conv_block" title="batchflow.models.tf.layers.conv_block"><code class="xref py py-func docutils literal notranslate"><span class="pre">conv_block()</span></code></a></p>
</dd>
<dt>initial_block<span class="classifier">dict</span></dt><dd><p>parameters for the input block, usually <a class="reference internal" href="batchflow.models.tf.layers.html#batchflow.models.tf.layers.conv_block" title="batchflow.models.tf.layers.conv_block"><code class="xref py py-func docutils literal notranslate"><span class="pre">conv_block()</span></code></a> parameters.</p>
<p>The only required parameter here is <code class="docutils literal notranslate"><span class="pre">initial_block/inputs</span></code> which should contain a name or
a list of names from <code class="docutils literal notranslate"><span class="pre">inputs</span></code> which tensors will be passed to <code class="docutils literal notranslate"><span class="pre">initial_block</span></code> as <code class="docutils literal notranslate"><span class="pre">inputs</span></code>.</p>
<p>Examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{'initial_block/inputs':</span> <span class="pre">'images'}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'initial_block':</span> <span class="pre">dict(inputs='features')}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'initial_block':</span> <span class="pre">dict(inputs='images',</span> <span class="pre">layout='nac</span> <span class="pre">nac',</span> <span class="pre">filters=64,</span> <span class="pre">kernel_size=[7,</span> <span class="pre">3],</span> <span class="pre">strides=[1,</span> <span class="pre">2])}</span></code></p></li>
</ul>
</dd>
<dt>body<span class="classifier">dict</span></dt><dd><p>parameters for the base network layers, usually <a class="reference internal" href="batchflow.models.tf.layers.html#batchflow.models.tf.layers.conv_block" title="batchflow.models.tf.layers.conv_block"><code class="xref py py-func docutils literal notranslate"><span class="pre">conv_block()</span></code></a> parameters</p>
</dd>
<dt>head<span class="classifier">dict</span></dt><dd><p>parameters for the head layers, usually <a class="reference internal" href="batchflow.models.tf.layers.html#batchflow.models.tf.layers.conv_block" title="batchflow.models.tf.layers.conv_block"><code class="xref py py-func docutils literal notranslate"><span class="pre">conv_block()</span></code></a> parameters</p>
</dd>
<dt>predictions<span class="classifier">str or callable</span></dt><dd><p>an operation applied to the head output to make the predictions tensor which is used in the loss function.</p>
</dd>
<dt>output<span class="classifier">dict or list</span></dt><dd><p>auxiliary operations</p>
</dd>
</dl>
<p>For more details about predictions and auxiliary output operations see <a class="reference internal" href="#batchflow.models.tf.base.TFModel.output" title="batchflow.models.tf.base.TFModel.output"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TFModel.output()</span></code></a>.</p>
<p><strong>How to create your own model</strong></p>
<ol class="arabic simple">
<li><p>Take a look at <a class="reference internal" href="batchflow.models.tf.layers.html#batchflow.models.tf.layers.conv_block" title="batchflow.models.tf.layers.conv_block"><code class="xref py py-func docutils literal notranslate"><span class="pre">conv_block()</span></code></a> since it is widely used as a building block almost everywhere.</p></li>
<li><p>Define model defaults (e.g. number of filters, batch normalization options, etc)
by overriding <a class="reference internal" href="#batchflow.models.tf.base.TFModel.default_config" title="batchflow.models.tf.base.TFModel.default_config"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TFModel.default_config()</span></code></a>.
Or skip it and hard code all the parameters in unpredictable places without the possibility to
change them easily through model’s config.</p></li>
<li><p>Define build configuration (e.g. number of classes, etc)
by overriding <a class="reference internal" href="#batchflow.models.tf.base.TFModel.build_config" title="batchflow.models.tf.base.TFModel.build_config"><code class="xref py py-meth docutils literal notranslate"><span class="pre">build_config()</span></code></a>.</p></li>
<li><p>Override <a class="reference internal" href="#batchflow.models.tf.base.TFModel.initial_block" title="batchflow.models.tf.base.TFModel.initial_block"><code class="xref py py-meth docutils literal notranslate"><span class="pre">initial_block()</span></code></a>, <a class="reference internal" href="#batchflow.models.tf.base.TFModel.body" title="batchflow.models.tf.base.TFModel.body"><code class="xref py py-meth docutils literal notranslate"><span class="pre">body()</span></code></a> and <a class="reference internal" href="#batchflow.models.tf.base.TFModel.head" title="batchflow.models.tf.base.TFModel.head"><code class="xref py py-meth docutils literal notranslate"><span class="pre">head()</span></code></a>, if needed.
In many cases defaults and build config are just enough to build a network without additional code writing.</p></li>
</ol>
<p>Things worth mentioning:</p>
<ol class="arabic simple">
<li><p>Input data and its parameters should be defined in configuration under <code class="docutils literal notranslate"><span class="pre">inputs</span></code> key.
See <a class="reference internal" href="#batchflow.models.tf.TFModel._make_inputs" title="batchflow.models.tf.TFModel._make_inputs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TFModel._make_inputs()</span></code></a> for details.</p></li>
<li><p>You might want to use a convenient multidimensional <a class="reference internal" href="batchflow.models.tf.layers.html#batchflow.models.tf.layers.conv_block" title="batchflow.models.tf.layers.conv_block"><code class="xref py py-func docutils literal notranslate"><span class="pre">conv_block()</span></code></a>,
as well as <a class="reference internal" href="batchflow.models.tf.layers.html#batchflow.models.tf.layers.global_average_pooling" title="batchflow.models.tf.layers.global_average_pooling"><code class="xref py py-func docutils literal notranslate"><span class="pre">global_average_pooling()</span></code></a>, <a class="reference internal" href="batchflow.models.tf.layers.html#batchflow.models.tf.layers.mip" title="batchflow.models.tf.layers.mip"><code class="xref py py-func docutils literal notranslate"><span class="pre">mip()</span></code></a>, or other predefined layers.
Of course, you can use usual <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/layers">tensorflow layers</a>.</p></li>
<li><p>If you make dropout, batch norm, etc by hand, you might use a predefined <code class="docutils literal notranslate"><span class="pre">self.is_training</span></code> tensor.</p></li>
<li><p>For decay and training control there is a predefined <code class="docutils literal notranslate"><span class="pre">self.global_step</span></code> tensor.</p></li>
<li><p>In many cases there is no need to write a loss function, learning rate decay and optimizer
as they might be defined through config.</p></li>
<li><p>For a configured loss to work one of the inputs should have a name <code class="docutils literal notranslate"><span class="pre">targets</span></code> and
one of the tensors in your model should have a name <code class="docutils literal notranslate"><span class="pre">predictions</span></code>.
They will be used in a loss function.</p></li>
<li><p>If you have defined your own loss function, call <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/losses/add_loss">tf.losses.add_loss(…)</a>.</p></li>
<li><p>If you need to use your own optimizer, assign <code class="docutils literal notranslate"><span class="pre">self.train_step</span></code> to the train step operation.
Don’t forget about <a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/layers/batch_normalization">UPDATE_OPS control dependency</a>.</p></li>
</ol>
<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.build">
<code class="sig-name descname">build</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.build"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.build" title="Permalink to this definition">¶</a></dt>
<dd><p>Build the model</p>
<ol class="arabic simple">
<li><p>Create a graph</p></li>
<li><p>Define <code class="docutils literal notranslate"><span class="pre">is_training</span></code> and <code class="docutils literal notranslate"><span class="pre">global_step</span></code> tensors</p></li>
<li><p>Define a model architecture by calling :meth:<code class="docutils literal notranslate"><span class="pre">._build</span></code></p></li>
<li><p>Create a loss function from config</p></li>
<li><p>Create an optimizer and define a train step from config</p></li>
<li><p><a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/layers/batch_normalization">Set UPDATE_OPS control dependency on train step</a></p></li>
<li><p>Create a tensorflow session</p></li>
</ol>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.create_session">
<code class="sig-name descname">create_session</code><span class="sig-paren">(</span><em class="sig-param">config=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.create_session"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.create_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Create TF session</p>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.reset">
<code class="sig-name descname">reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.reset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset the trained model to allow a new training from scratch</p>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.to_classes">
<code class="sig-name descname">to_classes</code><span class="sig-paren">(</span><em class="sig-param">tensor</em>, <em class="sig-param">input_name</em>, <em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.to_classes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.to_classes" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert tensor with labels to classes of <code class="docutils literal notranslate"><span class="pre">input_name</span></code></p>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.get_number_of_trainable_vars">
<code class="sig-name descname">get_number_of_trainable_vars</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.get_number_of_trainable_vars"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.get_number_of_trainable_vars" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of trainable variable in the model graph</p>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.get_tensor_config">
<code class="sig-name descname">get_tensor_config</code><span class="sig-paren">(</span><em class="sig-param">tensor</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.get_tensor_config"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.get_tensor_config" title="Permalink to this definition">¶</a></dt>
<dd><p>Return tensor configuration</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tensor</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em> or </em><em>tf.Tensor</em>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>tensor config (see <a class="reference internal" href="#batchflow.models.tf.TFModel._make_inputs" title="batchflow.models.tf.TFModel._make_inputs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TFModel._make_inputs()</span></code></a>)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)">dict</a></p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError shape in tensor configuration isn't int</strong><strong>, </strong><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><strong>tuple</strong></a><strong> or </strong><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><strong>list</strong></a> – </p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.train">
<code class="sig-name descname">train</code><span class="sig-paren">(</span><em class="sig-param">fetches=None</em>, <em class="sig-param">feed_dict=None</em>, <em class="sig-param">use_lock=False</em>, <em class="sig-param">train_mode=''</em>, <em class="sig-param">microbatch=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.train"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.train" title="Permalink to this definition">¶</a></dt>
<dd><p>Train the model with the data provided</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fetches</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a>) – a sequence of <cite>tf.Operation</cite> and/or <cite>tf.Tensor</cite> to calculate</p></li>
<li><p><strong>feed_dict</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a>) – input data, where key is a placeholder name and value is a numpy value</p></li>
<li><p><strong>use_lock</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – if True, the whole train step is locked, thus allowing for multithreading.</p></li>
<li><p><strong>train_mode</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em> or </em><em>sequence of str</em>) – name(s) of train step to optimize. Regular expressions are allowed.</p></li>
<li><p><strong>microbatch</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – size of chunks to split every batch in. Note that if this option was not specified
in the model configuration, the first invocation of this method would create additional operations.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Calculated values of tensors in <cite>fetches</cite> in the same structure</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/Session#run">Tensorflow Session run</a></p>
</div>
<p class="rubric">Notes</p>
<p><code class="docutils literal notranslate"><span class="pre">feed_dict</span></code> is not required as all placeholder names and their data can be passed directly as named arguments</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">fetches</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;images&#39;</span><span class="p">:</span> <span class="n">B</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">),</span> <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="n">B</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">)})</span>
</pre></div>
</div>
<p>The same as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">fetches</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="n">B</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="n">B</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.predict">
<code class="sig-name descname">predict</code><span class="sig-paren">(</span><em class="sig-param">fetches=None</em>, <em class="sig-param">feed_dict=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.predict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>Get predictions on the data provided</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fetches</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><em>tuple</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a>) – a sequence of <cite>tf.Operation</cite> and/or <cite>tf.Tensor</cite> to calculate</p></li>
<li><p><strong>feed_dict</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a>) – input data, where key is a placeholder name and value is a numpy value</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Calculated values of tensors in <cite>fetches</cite> in the same structure</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/Session#run">Tensorflow Session run</a></p>
</div>
<p class="rubric">Notes</p>
<p><code class="docutils literal notranslate"><span class="pre">feed_dict</span></code> is not required as all placeholder names and their data can be passed directly.</p>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fetches</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;images&#39;</span><span class="p">:</span> <span class="n">B</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">),</span> <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="n">B</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">)})</span>
</pre></div>
</div>
<p>The same as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fetches</span><span class="o">=</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="n">images</span><span class="o">=</span><span class="n">B</span><span class="p">(</span><span class="s1">&#39;images&#39;</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="n">B</span><span class="p">(</span><span class="s1">&#39;labels&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.save">
<code class="sig-name descname">save</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save tensorflow model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – a path to a directory where all model files will be stored</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tf_model</span> <span class="o">=</span> <span class="n">ResNet34</span><span class="p">()</span>
</pre></div>
</div>
<p>Now save the model</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tf_model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;/path/to/models/resnet34&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The model will be saved to /path/to/models/resnet34</p>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.load">
<code class="sig-name descname">load</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">graph=None</em>, <em class="sig-param">checkpoint=None</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load a TensorFlow model from files</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – a directory where a model is stored</p></li>
<li><p><strong>graph</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – a filename for a metagraph file</p></li>
<li><p><strong>checkpoint</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – a checkpoint file name or None to load the latest checkpoint</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">resnet</span> <span class="o">=</span> <span class="n">ResNet34</span><span class="p">(</span><span class="n">load</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;/path/to/models/resnet34&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tf_model</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;/path/to/models/resnet34&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.store_to_attr">
<code class="sig-name descname">store_to_attr</code><span class="sig-paren">(</span><em class="sig-param">attr</em>, <em class="sig-param">graph_item</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.store_to_attr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.store_to_attr" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a graph item (variable or operation) accessible as a model attribute</p>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.crop">
<em class="property">classmethod </em><code class="sig-name descname">crop</code><span class="sig-paren">(</span><em class="sig-param">inputs</em>, <em class="sig-param">resize_to</em>, <em class="sig-param">data_format='channels_last'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.crop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.crop" title="Permalink to this definition">¶</a></dt>
<dd><p>Crop input tensor to a shape of a given image.
If resize_to does not have a fully defined shape (resize_to.get_shape() has at least one None),
the returned tf.Tensor will be of unknown shape except the number of channels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> (<em>tf.Tensor</em>) – input tensor</p></li>
<li><p><strong>resize_to</strong> (<em>tf.Tensor</em>) – a tensor which shape the inputs should be resized to</p></li>
<li><p><strong>data_format</strong> (<em>str {'channels_last'</em><em>, </em><em>'channels_first'}</em>) – data format</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.initial_block">
<em class="property">classmethod </em><code class="sig-name descname">initial_block</code><span class="sig-paren">(</span><em class="sig-param">inputs</em>, <em class="sig-param">name='initial_block'</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.initial_block"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.initial_block" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform inputs with a convolution block</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> (<em>tf.Tensor</em>) – input tensor</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – scope name</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>For other parameters see <a class="reference internal" href="batchflow.models.tf.layers.html#batchflow.models.tf.layers.conv_block" title="batchflow.models.tf.layers.conv_block"><code class="xref py py-func docutils literal notranslate"><span class="pre">conv_block()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>tf.Tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.body">
<em class="property">classmethod </em><code class="sig-name descname">body</code><span class="sig-paren">(</span><em class="sig-param">inputs</em>, <em class="sig-param">name='body'</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.body"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.body" title="Permalink to this definition">¶</a></dt>
<dd><p>Base layers which produce a network embedding</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> (<em>tf.Tensor</em>) – input tensor</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – scope name</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>For other parameters see <a class="reference internal" href="batchflow.models.tf.layers.html#batchflow.models.tf.layers.conv_block" title="batchflow.models.tf.layers.conv_block"><code class="xref py py-func docutils literal notranslate"><span class="pre">conv_block()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>tf.Tensor</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MyModel</span><span class="o">.</span><span class="n">body</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;ca ca ca&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">512</span><span class="p">],</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.head">
<em class="property">classmethod </em><code class="sig-name descname">head</code><span class="sig-paren">(</span><em class="sig-param">inputs</em>, <em class="sig-param">name='head'</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.head"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.head" title="Permalink to this definition">¶</a></dt>
<dd><p>The last network layers which produce predictions</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> (<em>tf.Tensor</em>) – input tensor</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – scope name</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>For other parameters see <a class="reference internal" href="batchflow.models.tf.layers.html#batchflow.models.tf.layers.conv_block" title="batchflow.models.tf.layers.conv_block"><code class="xref py py-func docutils literal notranslate"><span class="pre">conv_block()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>tf.Tensor</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>A fully convolutional head with 3x3 and 1x1 convolutions and global max pooling:</p>
<blockquote>
<div><p>MyModel.head(network_embedding, layout=’cacaP’, filters=[128, num_classes], kernel_size=[3, 1])</p>
</div></blockquote>
<p>A fully connected head with dropouts, a dense layer with 1000 units and final dense layer with class logits:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MyModel</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">network_embedding</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="s1">&#39;dfadf&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">],</span> <span class="n">dropout_rate</span><span class="o">=.</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.output">
<code class="sig-name descname">output</code><span class="sig-paren">(</span><em class="sig-param">inputs</em>, <em class="sig-param">predictions=None</em>, <em class="sig-param">ops=None</em>, <em class="sig-param">prefix=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.output"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.output" title="Permalink to this definition">¶</a></dt>
<dd><p>Add output operations to the model graph, like predicted probabilities or labels, etc.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> (<em>tf.Tensor</em><em> or </em><em>a sequence of tf.Tensors</em>) – input tensors</p></li>
<li><p><strong>predictions</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em> or </em><em>callable</em>) – <p>an operation applied to inputs to get <cite>predictions</cite> tensor which is used in a loss function:</p>
<ul>
<li><p>’sigmoid’ - <code class="docutils literal notranslate"><span class="pre">sigmoid(inputs)</span></code></p></li>
<li><p>’proba’ - <code class="docutils literal notranslate"><span class="pre">softmax(inputs)</span></code></p></li>
<li><p>’labels’ - <code class="docutils literal notranslate"><span class="pre">argmax(inputs)</span></code></p></li>
<li><p>’softplus’ - <code class="docutils literal notranslate"><span class="pre">softplus(inputs)</span></code></p></li>
<li><p>callable - a user-defined operation</p></li>
</ul>
</p></li>
<li><p><strong>ops</strong> (<em>a sequence of operations</em><em> or </em><em>an ordered dict</em>) – <p>auxiliary operations</p>
<p>If dict:</p>
<ul>
<li><p>key - a prefix for each input</p></li>
<li><p>value - a sequence of aux operations</p></li>
</ul>
</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>ValueError if the number of inputs does not equal to the number of prefixes</strong> – </p></li>
<li><p><strong>TypeError if inputs is not a Tensor</strong><strong> or </strong><strong>a sequence of Tensors</strong> – </p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;proba&#39;</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>However, if one of the placeholders also has a name ‘labels’, then it will be lost as the model
will rewrite the name ‘labels’ with an output.</p>
<p>That is where a dict might be convenient:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;proba&#39;</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span><span class="p">]}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now the output will be stored under names ‘predicted_proba’ and ‘predicted_labels’.</p>
<p>For multi-output models ensure that an ordered dict is used (e.g. <a class="reference external" href="https://docs.python.org/3/library/collections.html#collections.OrderedDict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">OrderedDict</span></code></a>).</p>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.default_config">
<em class="property">classmethod </em><code class="sig-name descname">default_config</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.default_config"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.default_config" title="Permalink to this definition">¶</a></dt>
<dd><p>Define model defaults</p>
<p>You need to override this method if you expect your model or its blocks to serve as a base for other models
(e.g. VGG for FCN, ResNet for LinkNet, etc).</p>
<p>Put here all constants (like the number of filters, kernel sizes, block layouts, strides, etc)
specific to the model, but independent of anything else (like image shapes, number of classes, etc).</p>
<p>These defaults can be changed in <a class="reference internal" href="#batchflow.models.tf.base.TFModel.build_config" title="batchflow.models.tf.base.TFModel.build_config"><code class="xref py py-meth docutils literal notranslate"><span class="pre">build_config()</span></code></a> or when calling <a class="reference internal" href="batchflow.pipeline.html#batchflow.Pipeline.init_model" title="batchflow.Pipeline.init_model"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Pipeline.init_model()</span></code></a>.</p>
<p>Usually, it looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">default_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">TFModel</span><span class="o">.</span><span class="n">default_config</span><span class="p">()</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;initial_block&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;cnap&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                   <span class="n">pool_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">pool_strides</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;body/filters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;head&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s1">&#39;cnadV&#39;</span><span class="p">,</span> <span class="n">dropout_rate</span><span class="o">=.</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.fill_params">
<em class="property">classmethod </em><code class="sig-name descname">fill_params</code><span class="sig-paren">(</span><em class="sig-param">_name</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.fill_params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.fill_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Fill block params from default config and kwargs</p>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.build_config">
<code class="sig-name descname">build_config</code><span class="sig-paren">(</span><em class="sig-param">names=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.build_config"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.build_config" title="Permalink to this definition">¶</a></dt>
<dd><p>Define a model architecture configuration</p>
<p>It takes just 2 steps:</p>
<ol class="arabic">
<li><p>Define names for all placeholders and make input tensors by calling <code class="docutils literal notranslate"><span class="pre">super().build_config(names)</span></code>.</p>
<p>If the model config does not contain any name from <code class="docutils literal notranslate"><span class="pre">names</span></code>, <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#KeyError" title="(in Python v3.7)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code></a> is raised.</p>
<p>See <a class="reference internal" href="#batchflow.models.tf.TFModel._make_inputs" title="batchflow.models.tf.TFModel._make_inputs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TFModel._make_inputs()</span></code></a> for details.</p>
</li>
<li><p>Define parameters for <a class="reference internal" href="#batchflow.models.tf.base.TFModel.initial_block" title="batchflow.models.tf.base.TFModel.initial_block"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TFModel.initial_block()</span></code></a>, <a class="reference internal" href="#batchflow.models.tf.base.TFModel.body" title="batchflow.models.tf.base.TFModel.body"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TFModel.body()</span></code></a>, <a class="reference internal" href="#batchflow.models.tf.base.TFModel.head" title="batchflow.models.tf.base.TFModel.head"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TFModel.head()</span></code></a>
which depend on inputs.</p></li>
<li><p>Don’t forget to return <code class="docutils literal notranslate"><span class="pre">config</span></code>.</p></li>
</ol>
<p>Typically it looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">names</span> <span class="ow">or</span> <span class="p">[</span><span class="s1">&#39;images&#39;</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span><span class="p">]</span>
    <span class="n">config</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_config</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;head&#39;</span><span class="p">][</span><span class="s1">&#39;num_classes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_classes</span><span class="p">(</span><span class="s1">&#39;targets&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">config</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.data_format">
<code class="sig-name descname">data_format</code><span class="sig-paren">(</span><em class="sig-param">tensor</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.data_format"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.data_format" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the tensor data format (channels_last or channels_first)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tensor</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em> or </em><em>tf.Tensor</em>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>data_format</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.has_classes">
<code class="sig-name descname">has_classes</code><span class="sig-paren">(</span><em class="sig-param">tensor</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.has_classes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.has_classes" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if a tensor has classes defined in the config</p>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.classes">
<code class="sig-name descname">classes</code><span class="sig-paren">(</span><em class="sig-param">tensor</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.classes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.classes" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the classes</p>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.num_classes">
<code class="sig-name descname">num_classes</code><span class="sig-paren">(</span><em class="sig-param">tensor</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.num_classes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.num_classes" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the  number of classes</p>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.get_num_channels">
<code class="sig-name descname">get_num_channels</code><span class="sig-paren">(</span><em class="sig-param">tensor</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.get_num_channels"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.get_num_channels" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of channels in the tensor</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tensor</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em> or </em><em>tf.Tensor</em>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>number of channels</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.num_channels">
<em class="property">classmethod </em><code class="sig-name descname">num_channels</code><span class="sig-paren">(</span><em class="sig-param">tensor</em>, <em class="sig-param">data_format='channels_last'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.num_channels"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.num_channels" title="Permalink to this definition">¶</a></dt>
<dd><p>Return number of channels in the input tensor</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tensor</strong> (<em>tf.Tensor</em>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>shape</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tuple of ints</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.get_shape">
<code class="sig-name descname">get_shape</code><span class="sig-paren">(</span><em class="sig-param">tensor</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.get_shape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.get_shape" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the tensor shape without batch dimension</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tensor</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em> or </em><em>tf.Tensor</em>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>shape</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.shape">
<em class="property">classmethod </em><code class="sig-name descname">shape</code><span class="sig-paren">(</span><em class="sig-param">tensor</em>, <em class="sig-param">dynamic=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.shape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.shape" title="Permalink to this definition">¶</a></dt>
<dd><p>Return shape of the input tensor without batch size</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> (<em>tf.Tensor</em>) – </p></li>
<li><p><strong>dynamic</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – if True, returns tensor which represents shape. If False, returns list of ints and/or Nones</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>shape</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tf.Tensor or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)">list</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.get_spatial_dim">
<code class="sig-name descname">get_spatial_dim</code><span class="sig-paren">(</span><em class="sig-param">tensor</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.get_spatial_dim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.get_spatial_dim" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the tensor spatial dimensionality (without batch and channels dimensions)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tensor</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em> or </em><em>tf.Tensor</em>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>number of spatial dimensions</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.spatial_dim">
<em class="property">classmethod </em><code class="sig-name descname">spatial_dim</code><span class="sig-paren">(</span><em class="sig-param">tensor</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.spatial_dim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.spatial_dim" title="Permalink to this definition">¶</a></dt>
<dd><p>Return spatial dim of the input tensor (without channels and batch dimension)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tensor</strong> (<em>tf.Tensor</em>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>dim</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.get_spatial_shape">
<code class="sig-name descname">get_spatial_shape</code><span class="sig-paren">(</span><em class="sig-param">tensor</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.get_spatial_shape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.get_spatial_shape" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the tensor spatial shape (without batch and channels dimensions)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tensor</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em> or </em><em>tf.Tensor</em>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>spatial shape</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.spatial_shape">
<em class="property">classmethod </em><code class="sig-name descname">spatial_shape</code><span class="sig-paren">(</span><em class="sig-param">tensor</em>, <em class="sig-param">data_format='channels_last'</em>, <em class="sig-param">dynamic=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.spatial_shape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.spatial_shape" title="Permalink to this definition">¶</a></dt>
<dd><p>Return spatial shape of the input tensor</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> (<em>tf.Tensor</em>) – </p></li>
<li><p><strong>dynamic</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – if True, returns tensor which represents shape. If False, returns list of ints and/or Nones</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>shape</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tf.Tensor or <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)">list</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.get_batch_size">
<code class="sig-name descname">get_batch_size</code><span class="sig-paren">(</span><em class="sig-param">tensor</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.get_batch_size"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.get_batch_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Return batch size (the length of the first dimension) of the input tensor</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tensor</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em> or </em><em>tf.Tensor</em>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>batch size</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)">int</a> or <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)">None</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.batch_size">
<em class="property">classmethod </em><code class="sig-name descname">batch_size</code><span class="sig-paren">(</span><em class="sig-param">tensor</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.batch_size"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.batch_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Return batch size (the length of the first dimension) of the input tensor</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tensor</strong> (<em>tf.Tensor</em>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>batch size</strong></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)">int</a> or <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)">None</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.channels_axis">
<em class="property">classmethod </em><code class="sig-name descname">channels_axis</code><span class="sig-paren">(</span><em class="sig-param">data_format='channels_last'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.channels_axis"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.channels_axis" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the channels axis for the tensor</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data_format</strong> (<em>str {'channels_last'</em><em>, </em><em>'channels_first'</em><em>, </em><em>'N***'}</em><em> or </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)"><em>None</em></a>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.se_block">
<em class="property">classmethod </em><code class="sig-name descname">se_block</code><span class="sig-paren">(</span><em class="sig-param">inputs</em>, <em class="sig-param">ratio</em>, <em class="sig-param">name='se'</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.se_block"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.se_block" title="Permalink to this definition">¶</a></dt>
<dd><p>Squeeze and excitation block</p>
<p>Hu J. et al. “<a class="reference external" href="https://arxiv.org/abs/1709.01507">Squeeze-and-Excitation Networks</a>”</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> (<em>tf.Tensor</em>) – input tensor</p></li>
<li><p><strong>ratio</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – squeeze ratio for the number of filters</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tf.Tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.base.TFModel.upsample">
<em class="property">classmethod </em><code class="sig-name descname">upsample</code><span class="sig-paren">(</span><em class="sig-param">inputs</em>, <em class="sig-param">factor=None</em>, <em class="sig-param">resize_to=None</em>, <em class="sig-param">layout='b'</em>, <em class="sig-param">name='upsample'</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel.upsample"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.base.TFModel.upsample" title="Permalink to this definition">¶</a></dt>
<dd><p>Upsample input tensor</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> (<em>tf.Tensor</em><em> or </em><em>tuple of two tf.Tensor</em>) – a tensor to resize and a tensor which size to resize to</p></li>
<li><p><strong>factor</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.7)"><em>int</em></a>) – an upsamping scale</p></li>
<li><p><strong>resize_to</strong> (<em>tf.Tensor</em>) – a tensor which shape the output should be resized to</p></li>
<li><p><strong>layout</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – <p>a resizing technique, a sequence of:</p>
<ul>
<li><p>R - use residual connection with bilinear additive upsampling (must be the first symbol)</p></li>
<li><p>b - bilinear resize</p></li>
<li><p>B - bilinear additive upsampling</p></li>
<li><p>N - nearest neighbor resize</p></li>
<li><p>t - transposed convolution</p></li>
<li><p>X - subpixel convolution</p></li>
</ul>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tf.Tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="method">
<dt id="batchflow.models.tf.TFModel._make_inputs">
<code class="sig-prename descclassname">TFModel.</code><code class="sig-name descname">_make_inputs</code><span class="sig-paren">(</span><em class="sig-param">names=None</em>, <em class="sig-param">config=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/batchflow/models/tf/base.html#TFModel._make_inputs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#batchflow.models.tf.TFModel._make_inputs" title="Permalink to this definition">¶</a></dt>
<dd><p>Create model input data from config provided</p>
<p>In the config’s inputs section it looks for <code class="docutils literal notranslate"><span class="pre">names</span></code>, creates placeholders required, and
makes some typical transformations (like one-hot-encoding), if needed.</p>
<p><strong>Configuration</strong></p>
<dl class="simple">
<dt>inputs<span class="classifier">dict</span></dt><dd><ul class="simple">
<li><dl class="simple">
<dt>key<span class="classifier">str</span></dt><dd><p>a placeholder name</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>values<span class="classifier">str or dict or tuple</span></dt><dd><p>each input’s config</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p>Input config:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">dtype</span></code><span class="classifier">str or tf.DType (by default ‘float32’)</span></dt><dd><p>data type</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">shape</span></code><span class="classifier">int, tuple, list or None (default)</span></dt><dd><p>a tensor shape which includes the number of channels/classes and doesn’t include a batch size.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">classes</span></code><span class="classifier">int, array-like or None (default)</span></dt><dd><p>a number of class or an array of class labels if data labels are strings or anything else except
<code class="docutils literal notranslate"><span class="pre">np.arange(num_classes)</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">data_format</span></code><span class="classifier">str {‘channels_first’, ‘channels_last’} or {‘f’, ‘l’}</span></dt><dd><p>The ordering of the dimensions in the inputs. Default is ‘channels_last’.
For brevity <code class="docutils literal notranslate"><span class="pre">data_format</span></code> may be shortened to <code class="docutils literal notranslate"><span class="pre">df</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">transform</span></code><span class="classifier">str or callable</span></dt><dd><p>Predefined transforms are</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'ohe'</span></code> - one-hot encoding</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'mip</span> <span class="pre">&#64;</span> <span class="pre">d'</span></code> - maximum intensity projection <a class="reference internal" href="batchflow.models.tf.layers.html#batchflow.models.tf.layers.mip" title="batchflow.models.tf.layers.mip"><code class="xref py py-func docutils literal notranslate"><span class="pre">mip()</span></code></a>
with depth <code class="docutils literal notranslate"><span class="pre">d</span></code> (should be int)</p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code><span class="classifier">str</span></dt><dd><p>a name for the transformed tensor.</p>
</dd>
</dl>
<p>If an input config is a tuple, it should contain all items exactly in the order shown above:
dtype, shape, classes, data_format, transform, name.
If an item is None, the default value will be used instead.</p>
<p><strong>How it works</strong></p>
<p>A placholder with <code class="docutils literal notranslate"><span class="pre">dtype</span></code>, <code class="docutils literal notranslate"><span class="pre">shape</span></code> and with a name <code class="docutils literal notranslate"><span class="pre">key</span></code> is created first.
Then it is transformed with a <code class="docutils literal notranslate"><span class="pre">transform</span></code> function in accordance with <code class="docutils literal notranslate"><span class="pre">data_format</span></code>.
The resulting tensor will have the name <code class="docutils literal notranslate"><span class="pre">name</span></code>.</p>
<p><strong>Aliases</strong>
If an input config is a string, it should point to another key from inputs dict.
This creates an alias to another input which might be convenient to substitute tensor names.</p>
<p>By default, <cite>targets</cite> is aliased to <cite>labels</cite> or <cite>masks</cite> if present.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>names</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a>) – placeholder names that are expected in the config’s ‘inputs’ section</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>KeyError if there is any name missing in the config's 'inputs' section.</strong> – </p></li>
<li><p><strong>ValueError if there are duplicate names.</strong> – </p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul>
<li><p><strong>placeholders</strong> (<em>dict</em>) –</p>
<dl class="simple">
<dt>key<span class="classifier">str</span></dt><dd><p>a placeholder name</p>
</dd>
<dt>value<span class="classifier">tf.Tensor</span></dt><dd><p>placeholder tensor</p>
</dd>
</dl>
</li>
<li><p><strong>tensors</strong> (<em>dict</em>) –</p>
<dl class="simple">
<dt>key<span class="classifier">str</span></dt><dd><p>a placeholder name</p>
</dd>
<dt>value<span class="classifier">tf.Tensor</span></dt><dd><p>an input tensor after transformations</p>
</dd>
</dl>
</li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="batchflow.models.tf.vgg.html" title="VGG"
             >next</a> |</li>
        <li class="right" >
          <a href="batchflow.models.tf.models.html" title="Models"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">BatchFlow 0.3.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../intro/classes.html" >Classes and capabilities</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../intro/tf_models.html" >Tensorflow models</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="batchflow.models.tf.models.html" >Models</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Analysis Center.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.0.
    </div>
  </body>
</html>